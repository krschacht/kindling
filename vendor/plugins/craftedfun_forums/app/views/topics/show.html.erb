<style>
.user_<%= current_user.id %> .edit_links {
  display: inline;
}
</style>

<div class="topic_view">

  <%= render :partial => "topics/topic", 
             :object  => @topic,
             :locals  => { :show_forum_tree => true } %>

  <% if current_user.moderator? %>
    <%= render :partial => 'topics/admin_controls' %>
  <% end %>

  <%= render :partial => 'topics/public_controls' unless 
        ( ( @topic.locked? or @topic.sticky? ) and not current_user.moderator? ) or
        @forum.mode == "blog" %>

  <!-- this is passing a variable to the initialization of PostPaginate in forums.js -->
  <div id="topics_paginate_total_pages" class="hidden"><%= @topic.post_count / 50 %></div>
  
  <%= render :partial => 'topics/pagination', :locals => { :total_pages => @topic.post_count / 50 } %>
  
  <div class="bottom_jump <%= 'flagged' if @topic.flagged? %>">
    <%= link_to "Jump to Bottom", "#bottom" %>
  </div>
  
  <div class="post_container <%= 'flagged' if @topic.flagged? %>">    
    <div class="posts_container" id="posts_<%= @topic.id %>">
      <% post_count = 0 %>
      

      <% cache "topic/#{@topic.id}" do %>
        <div id="posts_page0" class="page_of_posts">

          <% @posts.each do |post| %>
            <% post_count += 1 %>
            <% if post_count % 50 == 0 %>
              </div><div id="posts_page<%= post_count / 50 %>" class="page_of_posts">
            <% end %>
        
            <%= render :partial => "posts/post", :object => post %>
          <% end %>
          
        </div> <!-- page_of_posts -->
      <% end # cache %>      
      
      
    </div> <!-- posts_container -->
  </div> <!-- post_container -->

  <div style="position: absolute; height: 200px; width: 2px; margin-top: -200px;">
    <a name="bottom"></a>
  </div>

  <%= render :partial => 'topics/pagination', :locals => { :total_pages => @topic.post_count / 50 } %>

  <div class="module_on_white centered">
    <%= link_to "Jump to Top", "#top" %>
  </div>

  <%= render :partial => "topics/post_form",
             :locals  => { :forum => @forum,
                           :topic => @topic,
                           :locked => @topic.locked? } %>
                             
</div>

